---
import PicksLayout from '../../layouts/PicksLayout.astro';
import PicksFooter from '../../components/picks/PicksFooter.astro';
import {
  categoryLabels,
  getRelatedPicks,
  getRepresentativeByCategory,
  picks,
} from '../../data/picks';
import type { PickProduct } from '../../data/picks';

export function getStaticPaths() {
  return picks.map((pick) => ({
    params: { slug: pick.slug },
    props: { pick },
  }));
}

const { pick } = Astro.props as { pick: PickProduct };

const related = getRelatedPicks(pick, 3);
const categoryLabel = categoryLabels[pick.category];
const categoryCards = getRepresentativeByCategory().slice(0, 3);
const pageTitle = `${pick.title} | Picks de CarlosCondor`;
const pageDescription = pick.shortDescription;
---

<PicksLayout title={pageTitle} description={pageDescription}>
  <header class="w-full border-b border-gray-50 bg-white sticky top-0 z-50">
    <nav class="max-w-[1440px] mx-auto px-6 h-16 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a
          class="p-2 hover:bg-gray-100 rounded-full transition-colors"
          data-purpose="back-button"
          href="/picks"
          aria-label="Volver a picks"
        >
          <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg>
        </a>
      </div>
      <div class="hidden md:flex items-center space-x-8 text-sm font-medium text-gray-500">
        <a class="hover:text-black transition-colors" href="/">Inicio</a>
        <a class="hover:text-black transition-colors text-black" href="/picks">Picks</a>
        <a class="hover:text-black transition-colors" href="https://CarlosCondor.github.io/">Blog</a>
      </div>
      <div class="flex items-center">
        <a
          class="p-2 hover:bg-gray-100 rounded-full transition-colors"
          href="mailto:j.carloscondor@gmail.com"
          aria-label="Contacto"
        >
          <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20"><path d="M4 6h16v12H4z"></path><path d="M22 7l-10 7L2 7"></path></svg>
        </a>
      </div>
    </nav>
  </header>

  <main class="max-w-[1440px] mx-auto px-6 py-8">
    <div class="flex flex-col md:flex-row justify-between items-baseline mb-8 gap-4">
      <div>
        <span class="text-xs uppercase tracking-widest text-gray-400 font-semibold mb-2 block">
          {pick.brand} · {categoryLabel}
        </span>
        <h1 class="text-4xl md:text-5xl font-bold">{pick.title}</h1>
      </div>
      <div class="flex flex-wrap items-center gap-4 sm:gap-6 mt-4 md:mt-0">
        <span class="text-3xl font-medium">{pick.priceLabel}</span>
        <span class="hidden sm:block h-8 w-[1px] bg-gray-200"></span>
        <a
          class="bg-[#111111] text-white px-6 py-3 rounded-full text-sm font-semibold flex items-center gap-2 hover:opacity-90 transition-opacity"
          href={pick.affiliateUrl}
          target="_blank"
          rel="noopener noreferrer"
        >
          Ver producto
          <svg fill="none" height="14" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" width="14"><path d="M7 17L17 7M17 7H7M17 7V17"></path></svg>
        </a>
      </div>
    </div>

    <section class="mb-16">
      <div class="bg-white border border-[#EAEAEA] shadow-[0_4px_18px_rgba(0,0,0,0.04)] rounded-3xl overflow-hidden aspect-square sm:aspect-[4/3] md:aspect-[16/9] flex items-center justify-center p-4 sm:p-6 md:p-12">
        <img alt={pick.title} class="w-full h-full object-contain object-center" data-purpose="hero-image" src={pick.image} style="filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.06));" />
      </div>
    </section>

    <section class="max-w-2xl mb-24">
      <h2 class="text-2xl font-bold mb-6">Por qué lo recomiendo</h2>
      <p class="text-gray-500 leading-relaxed text-lg">{pick.description}</p>
    </section>

    <section class="mb-24">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold">Más en {categoryLabel}</h2>
        <a class="text-sm font-medium text-gray-400 hover:text-black transition-colors" href="/picks">Ver todos</a>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {related.map((relatedPick) => (
          <a class="group cursor-pointer product-card-hover" href={`/picks/${relatedPick.slug}/`}>
            <div class="bg-white border border-[#EAEAEA] shadow-[0_4px_18px_rgba(0,0,0,0.04)] rounded-2xl p-8 mb-4 relative aspect-square flex items-center justify-center overflow-hidden transition-shadow duration-300 group-hover:shadow-[0_10px_24px_rgba(0,0,0,0.06)]">
              <div class="absolute top-4 right-4 bg-white/80 backdrop-blur rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity">
                <svg fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16"><path d="M7 17L17 7M17 7H7M17 7V17"></path></svg>
              </div>
              <img alt={relatedPick.title} class="product-image max-w-full h-auto object-contain" src={relatedPick.image} loading="lazy" style="filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.06));" />
            </div>
            <div class="flex justify-between items-start gap-4">
              <div>
                <p class="text-xs text-gray-400 uppercase font-semibold">{relatedPick.brand} · {categoryLabels[relatedPick.category]}</p>
                <h3 class="font-bold text-sm">{relatedPick.title}</h3>
              </div>
              <span class="font-bold text-sm whitespace-nowrap">{relatedPick.priceLabel}</span>
            </div>
          </a>
        ))}
      </div>
    </section>

    <section class="mb-32">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold">Explorar categorías</h2>
        <a class="text-sm font-medium text-gray-400 hover:text-black transition-colors" href="/picks">Ir al catálogo</a>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {categoryCards.map((item) => (
          <a class="group cursor-pointer" href="/picks">
            <div class="bg-white border border-gray-100 rounded-2xl p-8 mb-4 aspect-square flex items-center justify-center">
              <img alt={categoryLabels[item.category]} class="max-w-full h-auto object-contain" src={item.image} loading="lazy" />
            </div>
            <div class="flex justify-between items-center px-1">
              <h3 class="font-bold text-sm">{categoryLabels[item.category]}</h3>
              <span class="text-gray-400 text-sm font-medium">
                {picks.filter((p) => p.category === item.category).length}
              </span>
            </div>
          </a>
        ))}
      </div>
    </section>

    <PicksFooter />
  </main>
</PicksLayout>
